<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trashify - Pricing & System Settings</title>
    <link rel="stylesheet" href="css/admin-styles.css">
    <script src="https://kit.fontawesome.com/f8f98c7160.js" crossorigin="anonymous"></script>
</head>
<body>

    <div class="desktop-layout">
        
        <div class="sidebar-nav">
            <div class="sidebar-logo">
                <div><img src="img/trashifylogo.png" alt="Trashify Logo">Trashify</div>
                <span>Admin Panel</span>
            </div>
            <nav class="sidebar-menu">
                <a href="admin-dashboard.html"><span>üìä</span>Dashboard</a>
                <a href="admin-user-management.html"><span>üë§</span>Management</a>
                <a href="admin-tracking.html"><span>üó∫Ô∏è</span>Logistics Tracking</a>
                <a href="admin-analytics.html"><span>üìà</span>System Analytics</a>
                <a href="admin-rates.html" class="active"><span>‚öôÔ∏è</span>Pricing & Settings</a>
                <a href="admin-promotions.html"><span>üéÅ</span>Promotions</a>
                <a href="admin-machines.html"><span>ü§ñ</span>Machine Network</a>
            </nav>
        </div>

        <div class="main-area">
            
            <div class="admin-header">
                <span class="title">Pricing & System Settings</span>
                <div class="actions">
                    <a href="#" title="Notifications">
                        <i class="fa-solid fa-bell"></i>
                    </a>
                    <a href="admin-profile.html" title="Admin Profile">
                        <i class="fa-solid fa-user"></i>
                    </a>
                </div>
            </div>
            
            <div class="content">

                <h4>FACTORY RATE SELECTION</h4>
                <div style="max-width: 400px; margin-bottom: 20px;">
                    <select class="settings-select" id="factory-select" onchange="loadFactoryData(this.value)">
                        <option value="eco-sort" selected>EcoSort Inc. (Active Rate Source)</option>
                        <option value="coastal">Coastal Plastics</option>
                        <option value="meta">MetaRecycle Plant</option>
                        <option value="urban">Urban Paper Mills</option>
                    </select>
                </div>

                <h4>RECYCLABLE RATES FOR <span id="factory-name" style="color: green; font-weight: 700;">ECOSORT INC.</span></h4>
                <p style="color: var(--color-text-light); margin-bottom: 20px; max-width: 800px;">
                    Below are the current rates offered by the selected factory. These rates are <strong>read-only</strong> and directly impact user rewards.
                </p>

                <div class="settings-card" style="max-width: 800px; padding: 0;">
                    
                    <table class="data-table rates-table" id="rates-table">
                        <thead>
                            <tr>
                                <th style="width: 35%;">Material Type</th>
                                <th style="width: 30%; text-align: right;">Current Rate</th>
                                <th style="width: 20%;">Status</th>
                                <th style="width: 15%; text-align: center;">Last Updated</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>

                <h4>COMMISSION & SERVICE FEES (PLATFORM CONTROLS)</h4>
                <div class="settings-card">
                    <div class="price-input-group">
                        <label>Platform Commission (Factory) <span class="price-status-badge badge-info">Stable</span></label>
                        <input type="text" value="27%" placeholder="Percentage %">
                    </div>
                    <div class="price-input-group">
                        <label>Service Fee (User) <span class="price-status-badge badge-info">Fixed Rate</span></label>
                        <input type="text" value="$1.25 per pickup" placeholder="$ / pickup">
                    </div>
                </div>

                <button class="btn-primary btn-save-settings">Save Platform Controls</button>
            
            </div>
        </div>
    </div>

<script>
    const FACTORY_DATA = {
        'eco-sort': {
            name: "EcoSort Inc.",
            rates: [
                { material: "PET Plastic", rate: 0.55, status: "Available", active: true, updated: "4 hours ago" },
                { material: "HDPE Plastic", rate: 0.40, status: "Available", active: false, updated: "1 day ago" },
                { material: "Aluminum Cans", rate: 1.25, status: "Limited", active: true, updated: "2 days ago" },
                { material: "Mixed Paper", rate: 0.00, status: "Not Accepted", active: false, updated: "N/A" }
            ]
        },
        'coastal': {
            name: "Coastal Plastics",
            rates: [
                { material: "PET Plastic", rate: 0.58, status: "Available", active: false, updated: "3 hours ago" },
                { material: "HDPE Plastic", rate: 0.45, status: "Available", active: true, updated: "2 hours ago" },
                { material: "Aluminum Cans", rate: 0.00, status: "Not Accepted", active: false, updated: "N/A" },
                { material: "Mixed Paper", rate: 0.35, status: "Available", active: false, updated: "1 week ago" }
            ]
        },
        'meta': {
            name: "MetaRecycle Plant",
            rates: [
                { material: "PET Plastic", rate: 0.50, status: "Limited", active: false, updated: "1 day ago" },
                { material: "HDPE Plastic", rate: 0.38, status: "Available", active: false, updated: "1 day ago" },
                { material: "Aluminum Cans", rate: 1.30, status: "Available", active: true, updated: "1 hour ago" },
                { material: "Mixed Paper", rate: 0.00, status: "Not Accepted", active: false, updated: "N/A" }
            ]
        },
        'urban': {
            name: "Urban Paper Mills",
            rates: [
                { material: "PET Plastic", rate: 0.00, status: "Not Accepted", active: false, updated: "N/A" },
                { material: "HDPE Plastic", rate: 0.00, status: "Not Accepted", active: false, updated: "N/A" },
                { material: "Aluminum Cans", rate: 0.00, status: "Not Accepted", active: false, updated: "N/A" },
                { material: "Mixed Paper", rate: 0.32, status: "Available", active: true, updated: "2 days ago" }
            ]
        }
    };

    document.addEventListener('DOMContentLoaded', function() {
        const initialFactoryId = document.getElementById('factory-select').value;
        loadFactoryData(initialFactoryId);
    });

    function loadFactoryData(factoryId) {
        const data = FACTORY_DATA[factoryId];
        const tbody = document.querySelector('#rates-table tbody');
        const headingSpan = document.getElementById('factory-name');

        if (!data || !tbody || !headingSpan) return;

        // 1. Update the Heading
        headingSpan.textContent = data.name;

        // 2. Clear existing rows
        tbody.innerHTML = '';

        // 3. Render new rows based on factory data
        data.rates.forEach(item => {
            const row = document.createElement('tr');
            
            const isUnavailable = item.status === "Not Accepted";
            const isActive = item.active;

            let statusClass = '';
            if (item.status === "Not Accepted") {
                row.classList.add('unavailable-rate');
                statusClass = 'status-text atpickup'; // Red/Danger for Not Accepted
            } else if (item.status === "Limited") {
                statusClass = 'status-text enroute'; // Amber/Warning for Limited
            } else if (item.status === "Available") {
                statusClass = 'status-text completed'; // Green/Success for Available
            }

            if (isActive) {
                row.classList.add('active-rate');
            }
            
            const rateDisplay = isUnavailable ? 'N/A' : `$${item.rate.toFixed(2)} / kg`;
            // Updated to display Last Updated time
            const lastUpdatedDisplay = item.updated === "N/A" ? '‚Äî' : item.updated;
            
            const rateColor = isUnavailable ? 'var(--color-text-light)' : 'var(--color-text-dark)';

            row.innerHTML = `
                <td style="font-weight: 700;">${item.material}</td>
                <td style="text-align: right; font-weight: 700; color: ${rateColor};">${rateDisplay}</td>
                <td style="text-align: center;"><span class="${statusClass}">${item.status}</span></td>
                <td style="text-align: center; color: var(--color-text-light);">${lastUpdatedDisplay}</td>
            `;
            tbody.appendChild(row);
        });
    }
</script>
</body>
</html>